# Maintainer: Your Name <your@email.com>
pkgname=votetracker
pkgver=2.7.1
pkgrel=1
pkgdesc="School grade management application"
arch=('any')
license=('MIT')
depends=('python' 'pyside6' 'python-reportlab' 'python-requests')

# No source - we use local files
source=()
sha256sums=()

package() {
    # PKGBUILD is in scripts/, so go up to project root
    cd "$startdir/.."

    # Find Python version
    _pyver=$(python3 -c 'import sys; print(f"{sys.version_info.major}.{sys.version_info.minor}")')

    # Install Python package
    install -dm755 "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker"
    install -dm755 "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker/pages"
    install -dm755 "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker/providers"

    install -Dm644 src/votetracker/*.py -t "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker/"
    install -Dm644 src/votetracker/pages/*.py -t "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker/pages/"
    install -Dm644 src/votetracker/providers/*.py -t "$pkgdir/usr/lib/python$_pyver/site-packages/votetracker/providers/"

    # Install launcher script
    install -dm755 "$pkgdir/usr/bin"
    cat > "$pkgdir/usr/bin/votetracker" << 'EOF'
#!/usr/bin/env python3
from votetracker.__main__ import main
main()
EOF
    chmod +x "$pkgdir/usr/bin/votetracker"

    # Install .desktop file
    install -Dm644 scripts/votetracker.desktop "$pkgdir/usr/share/applications/votetracker.desktop"

    # Install icons
    for size in 16 24 32 48 64 128 256 512; do
        install -Dm644 "icons/icon-${size}.png" \
            "$pkgdir/usr/share/icons/hicolor/${size}x${size}/apps/votetracker.png"
    done
}
